
Процедура УправлениеФормой()
	
	Если глВерсия<3 ИЛИ НЕ ЭтотОбъект.ЛимитнаяКарта Тогда
		ЭлементыФормы.Панель1.Страницы.ЛимитнаяКарта.Видимость = Ложь;
		ЭлементыФормы.Панель1.Страницы.Основное.Видимость = Истина;
		ЭлементыФормы.Панель1.ТекущаяСтраница = ЭлементыФормы.Панель1.Страницы.Основное;
	Иначе
		ЭлементыФормы.Панель1.Страницы.Основное.Видимость = Ложь;
		ЭлементыФормы.Панель1.Страницы.ЛимитнаяКарта.Видимость = Истина;
		ЭлементыФормы.Панель1.ТекущаяСтраница = ЭлементыФормы.Панель1.Страницы.ЛимитнаяКарта;
	КонецЕсли; 
	
КонецПроцедуры
 
////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ ФОРМЫ

Процедура ПередОткрытием(Отказ, СтандартнаяОбработка)
	УправлениеРИБ.ПередОткрытиемЭлементаСправочника(ЭтотОбъект, ЭтаФорма, Отказ, СтандартнаяОбработка);
	
	Если НЕ ПараметрыСеанса.РаспределенныйРежим Тогда
		ЭлементыФормы.ИнформационнаяБаза.Видимость = Ложь;
	КонецЕсли; 
	
КонецПроцедуры

Процедура ПриОткрытии()
	
	Если ЭтоНовый() Тогда
		Если НЕ ЗначениеЗаполнено(ПараметрОбъектКопирования) Тогда
			ИнформационнаяБаза = ?(глВерсия=1, Неопределено, ПараметрыСеанса.ТекущаяИБ);
			
			
		КонецЕсли;
		
		УстановитьКодВнутриИБ();
	КонецЕсли;
		
	КартаДоступа = Справочники.КартыДоступа.НайтиПоРеквизиту("Привязка", Ссылка);
	
	Если глВерсия=1 Тогда
		ЭлементыФормы.НадписьСкидка.Видимость = Ложь;
		ЭлементыФормы.Скидка.Видимость = Ложь; 
	КонецЕсли; 
	Если глВерсия<3 Тогда
		ЭлементыФормы.НадписьКоммутироемоеУстройство.Видимость = Ложь;
		ЭлементыФормы.КоммутироемоеУстройство.Видимость = Ложь; 
	КонецЕсли; 
		
    Если глВерсия=1 ИЛИ НЕ Константы.ДопЯзыки.Получить() Тогда
		ЭлементыФормы.Панель1.Страницы.ДопНаименования.Видимость = Ложь;
	КонецЕсли; 
    
	Если глВерсия<3 Тогда
		ЭлементыФормы.ЛимитнаяКарта.Видимость = Ложь;
	КонецЕсли; 
    	
	Если НЕ ЗначениеЗаполнено(ПараметрОбъектКопирования) Тогда
		ИнтерфейсАдмина.ЗаполнитьДопНаименования(Ссылка,ТаблицаДопНаименования);
	Иначе
		ИнтерфейсАдмина.ЗаполнитьДопНаименования(ПараметрОбъектКопирования,ТаблицаДопНаименования);
	КонецЕсли;
	
	УправлениеФормой();
		
	Попытка
		ЭлементыФормы.Панель1.ТекущаяСтраница = ЭлементыФормы.Панель1.Страницы[ВосстановитьЗначение("ТекущаяСтраницаПосадочныеМеста")];
	Исключение
	КонецПопытки;
	
КонецПроцедуры

Процедура ПриЗакрытии()
	СохранитьЗначение("ТекущаяСтраницаПосадочныеМеста", ЭлементыФормы.Панель1.ТекущаяСтраница.Имя);
КонецПроцедуры

Процедура ПриЗаписи(Отказ)
	ИнтерфейсАдмина.ЗаписатьДопНаименования(Ссылка,ТаблицаДопНаименования);
КонецПроцедуры

Процедура ОбновлениеОтображения()
	
	ЭлементыФормы.ИнфНадписьКодДоступа.Заголовок = КартаДоступа.Код;
	
	ЭлементыФормы.ИнформационнаяБаза.ГиперСсылка = МестоРеализации.Пустая() ИЛИ (глВерсия=3 И ЭтотОбъект.ЛимитнаяКарта);
	
КонецПроцедуры

Процедура ВнешнееСобытие(Источник, Событие, Данные)
	Если Не ВводДоступен() Тогда
		Возврат;
	КонецЕсли;  
	
	_Знач = ОбработкаВнешнихСобытий.ПолучитьДанные(Источник,Событие,Данные);
	Если глВерсия<3 ИЛИ НЕ ЗначениеЗаполнено(_Знач) Тогда
		Возврат;
	КонецЕсли;
	
	ВыбКарта = "Идентификатор_"+_Знач;
	
	Если ИнтерфейсАдмина.ОбработкаВыбораКартыДоступа(ВыбКарта, КартаДоступа, Ссылка) Тогда
		КартаДоступа = ВыбКарта;
	КонецЕсли;
	
	Попытка
		ЭлементыФормы.Панель1.ТекущаяСтраница = ЭлементыФормы.Панель1.Страницы["Идентификация"];
	Исключение
	КонецПопытки;

КонецПроцедуры
////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ ЭЛЕМЕНТОВ ФОРМЫ

Процедура СкидкаНачалоВыбора(Элемент, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	ИнтерфейсАдмина.ВыборСкидкиБонуса(Элемент, Ложь);
	
КонецПроцедуры

Процедура АвтоТоварыПриВыводеСтроки(Элемент, ОформлениеСтроки, ДанныеСтроки)
	
	ОформлениеСтроки.Ячейки.ПоКоличествуПосетителей.ОтображатьТекст = Ложь;
	
КонецПроцедуры

Процедура КартаДоступаОбработкаВыбора(Элемент, ВыбранноеЗначение, СтандартнаяОбработка)
	
	СтандартнаяОбработка = ИнтерфейсАдмина.ОбработкаВыбораКартыДоступа(ВыбранноеЗначение, КартаДоступа, Ссылка);
	
КонецПроцедуры

Процедура КартаДоступаОчистка(Элемент, СтандартнаяОбработка)
	
	СтандартнаяОбработка = ИнтерфейсАдмина.ОбработкаОчисткиКартыДоступа(КартаДоступа);
	
КонецПроцедуры

Процедура ЛимитнаяКартаПриИзменении(Элемент)
	
	УправлениеФормой();
	
	Если глВерсия=3 И ЭтотОбъект.ЛимитнаяКарта Тогда
		МестоРеализации = Неопределено;
	КонецЕсли; 
	
КонецПроцедуры

Процедура МестоРеализацииПриИзменении(Элемент)
	
	Если НЕ МестоРеализации.Пустая() Тогда
		ИнформационнаяБаза = МестоРеализации.ИнформационнаяБаза;
		УстановитьКодВнутриИБ();
	КонецЕсли; 
	
КонецПроцедуры

Процедура ИнформационнаяБазаНажатие(Элемент)
	
	ВыбЭлемент = ИнтерфейсАдмина.ИнфБазаВыбратьИзСписка(ЭтаФорма, Элемент);
	Если ВыбЭлемент <> Неопределено Тогда
		ИнформационнаяБаза = ВыбЭлемент.Значение;
		УстановитьКодВнутриИБ();
	КонецЕсли; 
	
КонецПроцедуры




