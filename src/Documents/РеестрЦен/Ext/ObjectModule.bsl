Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)
	
КонецПроцедуры

Процедура ПриЗаписи(Отказ)
	Если Проведен Тогда
		
		Если Не ФоновыеЗадания.ПолучитьФоновыеЗадания(Новый Структура("Ключ, Состояние", "ВыгрузитьЦеныПоРеестрамЦен", СостояниеФоновогоЗадания.Активно)).Количество() Тогда
			ФоновыеЗадания.Выполнить("ВыполнениеРегламентныхЗаданий.ВыгрузитьЦеныПоРеестрамЦен",,"ВыгрузитьЦеныПоРеестрамЦен");
		КонецЕсли;
		
		ОчиститьЦены();
		ЗаписатьЦены();		
	КонецЕсли;
КонецПроцедуры


Процедура ОбработкаПроведения(Отказ, РежимПроведения)
КонецПроцедуры


Процедура ЗаписатьЦены()
	Для Каждого Т Из Товары Цикл
		Нов = РегистрыСведений.ЦеныНоменклатуры.СоздатьМенеджерЗаписи();
		Нов.РеестрЦен = Ссылка;
		Нов.Номенклатура = Т.Номенклатура;
		Нов.ТипЦен = КатегорияЦен;
		Нов.Цена = Т.Цена;
		Нов.Период = Дата;
		Нов.Записать();
	КонецЦикла;
КонецПроцедуры



Процедура ОчиститьЦены()
	Выб = РегистрыСведений.Цены.Выбрать(,,Новый Структура("РеестрЦен", Ссылка));
	Пока Выб.Следующий() Цикл
		Выб.ПолучитьМенеджерЗаписи().Удалить();		
	КонецЦикла;
	
	Выб = РегистрыСведений.ЦеныНоменклатуры.Выбрать(,,Новый Структура("РеестрЦен", Ссылка));
	Пока Выб.Следующий() Цикл
		Выб.ПолучитьМенеджерЗаписи().Удалить();		
	КонецЦикла;

КонецПроцедуры

Процедура ОбработкаУдаленияПроведения(Отказ)
	ОчиститьЦены();
КонецПроцедуры

Процедура ПередУдалением(Отказ)
		ОчиститьЦены();
КонецПроцедуры
